<div class="{{#if wrapper_class}}{{wrapper_class}}{{else}}mb-3{{/if}}">
    {{#if label}}
    <label for="{{name}}" class="form-label {{#if required}}required{{/if}}">
        {{#if icon}}
        <i class="{{icon}} me-2"></i>
        {{/if}}
        {{label}}
        {{#if required}}
        <span class="text-danger">*</span>
        {{/if}}
    </label>
    {{/if}}

    {{#if (eq type 'select')}}
    <select class="form-select {{#if errors}}is-invalid{{/if}} {{class}}"
            id="{{name}}"
            name="{{name}}"
            {{#if required}}required{{/if}}
            {{#if disabled}}disabled{{/if}}
            {{#if multiple}}multiple{{/if}}
            {{#if attributes}}{{{attributes}}}{{/if}}>
        {{#unless multiple}}
        <option value="">{{#if placeholder}}{{placeholder}}{{else}}Select an option{{/if}}</option>
        {{/unless}}
        {{#each options}}
        <option value="{{value}}"
                {{#if (eq value ../selected)}}selected{{/if}}
                {{#if (includes ../selected value)}}selected{{/if}}
                {{#if disabled}}disabled{{/if}}>
            {{label}}
        </option>
        {{/each}}
    </select>

    {{else if (eq type 'textarea')}}
    <textarea class="form-control {{#if errors}}is-invalid{{/if}} {{class}}"
              id="{{name}}"
              name="{{name}}"
              rows="{{#if rows}}{{rows}}{{else}}4{{/if}}"
              placeholder="{{placeholder}}"
              {{#if required}}required{{/if}}
              {{#if disabled}}disabled{{/if}}
              {{#if readonly}}readonly{{/if}}
              {{#if maxlength}}maxlength="{{maxlength}}"{{/if}}
              {{#if attributes}}{{{attributes}}}{{/if}}>{{value}}</textarea>

    {{else if (eq type 'file')}}
    <input type="file"
           class="form-control {{#if errors}}is-invalid{{/if}} {{class}}"
           id="{{name}}"
           name="{{name}}"
           {{#if required}}required{{/if}}
           {{#if disabled}}disabled{{/if}}
           {{#if multiple}}multiple{{/if}}
           {{#if accept}}accept="{{accept}}"{{/if}}
           {{#if attributes}}{{{attributes}}}{{/if}}>

    {{else if (eq type 'checkbox')}}
    <div class="form-check {{#if inline}}form-check-inline{{/if}}">
        <input class="form-check-input {{#if errors}}is-invalid{{/if}} {{class}}"
               type="checkbox"
               id="{{name}}"
               name="{{name}}"
               value="{{#if checkbox_value}}{{checkbox_value}}{{else}}1{{/if}}"
               {{#if checked}}checked{{/if}}
               {{#if required}}required{{/if}}
               {{#if disabled}}disabled{{/if}}
               {{#if attributes}}{{{attributes}}}{{/if}}>
        <label class="form-check-label" for="{{name}}">
            {{#if checkbox_label}}{{checkbox_label}}{{else}}{{label}}{{/if}}
        </label>
    </div>

    {{else if (eq type 'radio')}}
    <div class="form-radio-group">
        {{#each options}}
        <div class="form-check {{#if ../inline}}form-check-inline{{/if}}">
            <input class="form-check-input {{#if ../errors}}is-invalid{{/if}} {{../class}}"
                   type="radio"
                   id="{{../name}}_{{@index}}"
                   name="{{../name}}"
                   value="{{value}}"
                   {{#if (eq value ../selected)}}checked{{/if}}
                   {{#if ../required}}required{{/if}}
                   {{#if ../disabled}}disabled{{/if}}
                   {{#if disabled}}disabled{{/if}}
                   {{#if ../attributes}}{{{../attributes}}}{{/if}}>
            <label class="form-check-label" for="{{../name}}_{{@index}}">
                {{label}}
            </label>
        </div>
        {{/each}}
    </div>

    {{else if (eq type 'date-range')}}
    <div class="input-group">
        <input type="date"
               class="form-control {{#if errors}}is-invalid{{/if}} {{class}}"
               id="{{name}}_from"
               name="{{name}}_from"
               value="{{value.from}}"
               placeholder="From date"
               {{#if required}}required{{/if}}
               {{#if disabled}}disabled{{/if}}
               {{#if readonly}}readonly{{/if}}
               {{#if min}}min="{{min}}"{{/if}}
               {{#if max}}max="{{max}}"{{/if}}
               {{#if attributes}}{{{attributes}}}{{/if}}>
        <span class="input-group-text">to</span>
        <input type="date"
               class="form-control {{#if errors}}is-invalid{{/if}} {{class}}"
               id="{{name}}_to"
               name="{{name}}_to"
               value="{{value.to}}"
               placeholder="To date"
               {{#if required}}required{{/if}}
               {{#if disabled}}disabled{{/if}}
               {{#if readonly}}readonly{{/if}}
               {{#if min}}min="{{min}}"{{/if}}
               {{#if max}}max="{{max}}"{{/if}}
               {{#if attributes}}{{{attributes}}}{{/if}}>
    </div>

    {{else if (eq type 'password')}}
    <div class="position-relative">
        <input type="password"
               class="form-control {{#if errors}}is-invalid{{/if}} {{class}}"
               id="{{name}}"
               name="{{name}}"
               value="{{value}}"
               placeholder="{{placeholder}}"
               {{#if required}}required{{/if}}
               {{#if disabled}}disabled{{/if}}
               {{#if readonly}}readonly{{/if}}
               {{#if minlength}}minlength="{{minlength}}"{{/if}}
               {{#if maxlength}}maxlength="{{maxlength}}"{{/if}}
               {{#if pattern}}pattern="{{pattern}}"{{/if}}
               {{#if autocomplete}}autocomplete="{{autocomplete}}"{{/if}}
               {{#if attributes}}{{{attributes}}}{{/if}}>
        {{#if show_toggle}}
        <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y pe-3" onclick="togglePassword('{{name}}')">
            <i class="fas fa-eye" id="{{name}}_toggle_icon"></i>
        </button>
        {{/if}}
    </div>

    {{else}}
    {{!-- Default input types: text, email, url, tel, number, etc. --}}
    <input type="{{#if type}}{{type}}{{else}}text{{/if}}"
           class="form-control {{#if errors}}is-invalid{{/if}} {{class}}"
           id="{{name}}"
           name="{{name}}"
           value="{{value}}"
           placeholder="{{placeholder}}"
           {{#if required}}required{{/if}}
           {{#if disabled}}disabled{{/if}}
           {{#if readonly}}readonly{{/if}}
           {{#if minlength}}minlength="{{minlength}}"{{/if}}
           {{#if maxlength}}maxlength="{{maxlength}}"{{/if}}
           {{#if min}}min="{{min}}"{{/if}}
           {{#if max}}max="{{max}}"{{/if}}
           {{#if step}}step="{{step}}"{{/if}}
           {{#if pattern}}pattern="{{pattern}}"{{/if}}
           {{#if autocomplete}}autocomplete="{{autocomplete}}"{{/if}}
           {{#if attributes}}{{{attributes}}}{{/if}}>
    {{/if}}

    {{#if errors}}
    <div class="invalid-feedback">
        {{#each errors}}
        <div>{{this}}</div>
        {{/each}}
    </div>
    {{/if}}

    {{#if help_text}}
    <div class="form-text">
        {{#if help_icon}}
        <i class="{{help_icon}} me-1"></i>
        {{/if}}
        {{help_text}}
    </div>
    {{/if}}

    {{#if (eq type 'file')}}
    {{#if preview}}
    <div class="file-preview mt-2">
        {{#each preview}}
        <div class="file-preview-item">
            {{#if (eq type 'image')}}
            <img src="{{url}}" alt="{{name}}" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
            {{else}}
            <div class="file-info">
                <i class="fas fa-file me-2"></i>
                <span>{{name}} ({{size}})</span>
            </div>
            {{/if}}
        </div>
        {{/each}}
    </div>
    {{/if}}
    {{/if}}
</div>

{{#if (eq type 'password')}}
{{#if show_toggle}}
<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(fieldId + '_toggle_icon');

    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}
</script>
{{/if}}
{{/if}}